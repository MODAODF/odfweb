!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/",i(i.s=5)}([function(e,t,i){"use strict";var n,a=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},r=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),s=[];function o(e){for(var t=-1,i=0;i<s.length;i++)if(s[i].identifier===e){t=i;break}return t}function l(e,t){for(var i={},n=[],a=0;a<e.length;a++){var r=e[a],l=t.base?r[0]+t.base:r[0],c=i[l]||0,d="".concat(l," ").concat(c);i[l]=c+1;var u=o(d),f={css:r[1],media:r[2],sourceMap:r[3]};-1!==u?(s[u].references++,s[u].updater(f)):s.push({identifier:d,updater:h(f,t),references:1}),n.push(d)}return n}function c(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var a=i.nc;a&&(n.nonce=a)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var s=r(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var d,u=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function f(e,t,i,n){var a=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=u(t,a);else{var r=document.createTextNode(a),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function p(e,t,i){var n=i.css,a=i.media,r=i.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var b=null,m=0;function h(e,t){var i,n,a;if(t.singleton){var r=m++;i=b||(b=c(t)),n=f.bind(null,i,r,!1),a=f.bind(null,i,r,!0)}else i=c(t),n=p.bind(null,i,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var i=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<i.length;n++){var a=o(i[n]);s[a].references--}for(var r=l(e,t),c=0;c<i.length;c++){var d=o(i[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}i=r}}}},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=e(t);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,n){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(n)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(a[s]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);n&&a[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},function(e,t,i){"use strict";var n=i(1),a=i.n(n)()((function(e){return e[1]}));a.push([e.i,'#fileSubscriptionTabView .icon{display:inline-block}#fileSubscriptionTabView .msg{color:#000;font-size:13px;padding:2px;margin-left:5px}#fileSubscriptionTabView .msg.success{color:#fff;background-color:#47a447}#fileSubscriptionTabView .msg.error{color:#fff;background-color:#d2322d}#fileSubscriptionTabView .lasttime{font-size:13px}#fileSubscriptionTabView .itemEntry{display:flex;align-items:center;justify-content:space-between}#fileSubscriptionTabView .itemEntry .entryAvatar,#fileSubscriptionTabView .itemEntry button{width:32px;height:32px;border-radius:50%}#fileSubscriptionTabView .itemEntry .entryAvatarClose{background-color:#ef5350}#fileSubscriptionTabView .itemEntry .entryAvatarOpen{background-color:#8bc34a}#fileSubscriptionTabView .itemEntry .entryAvatarInvaild{background-color:gray}#fileSubscriptionTabView .itemEntry .entryDesc{display:flex;flex-direction:column;padding:8px;line-height:1.2em;overflow:hidden}#fileSubscriptionTabView .itemEntry .entryDesc div{font-size:12.5px;color:var(--color-text-maxcontrast)}#fileSubscriptionTabView .itemEntry button.entryEdit{background-color:inherit;border:none;margin-left:auto;transition:all .05s ease-in-out}#fileSubscriptionTabView .itemEntry button.entryEdit:enabled:hover{background-color:lightgrey}#fileSubscriptionTabView .itemEntry button.entryEdit.rotate{transform:rotate(180deg)}#fileSubscriptionTabView ul{margin-left:32px}#fileSubscriptionTabView ul::after{content:" ";border-bottom:2px solid #e0e0e0;display:block;margin:30px 0;position:relative}#fileSubscriptionTabView ul li{margin-top:25px}#fileSubscriptionTabView ul li>div:first-child{display:flex;align-items:center;margin-bottom:5px}#fileSubscriptionTabView ul li>div:first-child .icon{margin-right:10px}#fileSubscriptionTabView ul textarea{width:100%;resize:vertical;max-height:400px}#fileSubscriptionTabView ul textarea ~ div{display:flex;justify-content:space-between;align-items:center}#fileSubscriptionTabView ul textarea ~ div .setDescr{justify-self:flex-end;margin-left:auto}\n',""]),t.a=a},,,function(e,i,n){"use strict";n.r(i);var a,r=n(0),s=n.n(r),o=n(2),l={insert:"head",singleton:!1};s()(o.a,l),o.a.locals;a=OCA.Files.DetailTabView.extend({id:"fileSubscriptionTabView",className:"tab fileSubscriptionTabView",appId:"filesubscription",getLabel:function(){return t(this.appId,"subscription")},getIcon:function(){return"icon-mail"},template:function(){return'<div class="loading icon-loading-small"></div>\n\t\t\t  <div class="linksWrapper hidden"></div>\n\t\t\t  <button class="reloadLinks hidden">'.concat(t(this.appId,"Reload"),"</button>")},_sectionTemplates:{l10n:function(e){return t("filesubscription",e)},getLinkFail:function(){return"<div>".concat(this.l10n("Unable to get share link"),"</div>")},noLink:function(){return"<div>".concat(this.l10n("No share link"),"</div>")},notOwner:function(){return"<div>".concat(this.l10n("Not file owner"),"</div>")},$item:function(e){return'<div class="item" share-id='.concat(e,"></div>")},$itemContent_vaild:function(e,t){var i={shareId:t.id,labelName:t.label,isEnabled:e.enabled,entryAvatarCssClass:e.enabled?"entryAvatarOpen":"entryAvatarClose",message:e.message,subscriberNum:e.subscriberNum,buttonDisable:e.subscriberNum>0?"":"disabled",strEntrySubscriberNum:this.l10n("Subscribers"),strEntryEnable:this.l10n(e.enabled?"Enabled":"Disabled"),strEntryTitle:this.l10n("Share Link"),strLiTitleEdit:this.l10n("Notification message"),strLastUpdateOn:this.l10n("Last updated on"),strSave:this.l10n("Save"),strLiTitleMail:this.l10n("Email subscription"),strSend:this.l10n("Send"),strLastEmailOn:this.l10n("Last notified on"),strLiTitleCancel:this.l10n("Cancel subscribers"),strCancel:this.l10n("Cancel"),strLastCancelOn:this.l10n("Last cancelled on")};return e.last_message_time&&(i.lastMessageTime=e.last_message_time),e.last_email_time&&(i.lastEmailTime=e.last_email_time),e.last_cancel_time&&(i.lastCancelTime=e.last_cancel_time),OCA.FileSubscription.Templates["sidebar-vaildItem"](i)},$itemContent_invaild:function(e,t){var i={shareId:e.share_id,labelName:e.share_label,hasLog:t,strEntryTitle:this.l10n("Share Link"),strEntryDeleted:this.l10n("Deleted"),strBtnLog:this.l10n("Download notification log"),strNoLog:this.l10n("There is no notification log for this share link."),strBtnDelete:this.l10n("Delete")};return OCA.FileSubscription.Templates["sidebar-invaildItem"](i)}},render:function(){this.$el.html(this.template()),this._getInitData(),this.delegateEvents({"click button.reloadLinks":"render","click button.entryEdit":"_onEntryEdit","change input[name=subscribable]":"_onSubscrSetting","click button.setDescr":"_onSubscrSetting","click button.sendSubscrMail":"_onSendMailEvent","click button.cancelSubscr":"_onCancelEvent","click button.downloadLog":"_onLogDownloadEvent","click button.deleteLog":"_onLogDeletelEvent"})},_getInitData:function(){var e=this.getFileInfo(),t=e.attributes.id,i="".concat(e.attributes.path,"/").concat(e.attributes.name);$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/")),type:"POST",data:{fileId:t,path:JSON.stringify(i.replace("//","/"))},beforeSend:function(){$(".linksWrapper").hide(),$(".reloadLinks").hide(),$(this.$el).find(".loading").show()}}).done((function(e){var t={data:e};void 0===e.result||e.result||(t={data:null,errorType:"notOwner"}),this._renderInitData(t)})).fail((function(e){this._renderInitData({data:null,errorType:"getLinkFail"})})).always((function(e){$(this.$el).find(".loading").hide()}))},_renderInitData:function(e){var t=$(".linksWrapper");if(!(t.length<1)){t.children().remove();var i=this._sectionTemplates;if(e&&e.data)if(e.data.length<1)t.html(i.noLink());else for(var n in e.data){var a=e.data[n],r=i.$item(a.subscription.share_id),s=".item[share-id=".concat(a.subscription.share_id,"]"),o=a.sharing?i.$itemContent_vaild(a.subscription,a.sharing):i.$itemContent_invaild(a.subscription,a.hasSubscrLog);0===$(s).length&&t.append(r),0===$(s).children().length&&($(s).append(o),$(s).find("button.entryEdit").click())}else"notOwner"===e.errorType?t.html(i.notOwner()):t.html(i.getLinkFail());t.show(),$(".reloadLinks").show()}},_rerenderItemData:function(e){var t=$("div.item[share-id=".concat(e.share_id,"]")),i={id:e.share_id,label:t.find(".itemEntry h5 span").text()},n={enabled:e.enabled,message:e.message,subscriberNum:e.subscriberNum,last_message_time:e.last_message_time,last_email_time:e.last_email_time,last_cancel_time:e.last_cancel_time};t.html(this._sectionTemplates.$itemContent_vaild(n,i))},_onEntryEdit:function(e){var t=$(e.target).closest(".item").attr("share-id");$(".item[share-id=".concat(t,"] ul")).toggle(500),$(".item[share-id=".concat(t,"] .entryEdit")).toggleClass("rotate"),$(".item:not([share-id=".concat(t,"]) ul")).hide(500),$(".item:not([share-id=".concat(t,"]) .entryEdit")).removeClass("rotate")},_onSendMailEvent:function(e){var i=$(e.target).closest(".item").attr("share-id"),n=$(".item[share-id]").find("button, input, textarea"),a=$(e.target).closest("li").find(".msg"),r={status:"",data:{message:""}};$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/mail/update")),type:"POST",data:{shareId:i},beforeSend:function(){n.attr("disabled","disabled"),OC.msg.startAction(a,t(this.appId,"Sending..."))}}).done((function(e){r.status="success",r.data.message=e.data.message;var n=$(".item[share-id=".concat(i,"]")).find(".sendSubscrMail ~ .lasttime");n.find("em").length>0?n.find("em > span").text(e.data.lastEmailTime):n.append("<em>".concat(t(this.appId,"Last notified on")," <span>").concat(e.data.lastEmailTime,"</span></em>"))})).fail((function(e){void 0!==e.responseJSON.data.message&&(r.data.message+=e.responseJSON.data.message)})).always((function(){OC.msg.finishedAction(a,r),n.removeAttr("disabled")}))},_onSubscrSetting:function(e){var i=$(e.target).closest(".item").attr("share-id"),n={enabled:$("#subscribable".concat(i)).is(":checked"),message:$("#versionDescr".concat(i)).val(),updateMessageTime:$(e.target).hasClass("setDescr")},a=$(".item[share-id]").find("button, input, textarea"),r=$(e.target).closest("li").find(".msg"),s={status:"",data:{message:""}};$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/update/").concat(i)),type:"POST",data:{shareId:i,setVal:n},beforeSend:function(){a.attr("disabled","disabled"),OC.msg.startAction(r,t(this.appId,"Setting..."))}}).done((function(e){this._rerenderItemData(e)})).fail((function(e){s.data.message=t(this.appId,"Failed")})).always((function(){OC.msg.finishedAction(r,s),a.removeAttr("disabled")}))},_onCancelEvent:function(e){var i=$(".item[share-id]").find("button, input, textarea");i.attr("disabled","disabled");var n=this;OC.dialogs.confirm(t(this.appId,"The system will send a cancellation notice to subscribers and remove all subscribers."),t(this.appId,"Please confirm the cancellation"),(function(a){if(a){var r=$(e.target).closest("li").find(".msg"),s={status:"",data:{message:""}};$.ajax({context:n,url:OC.generateUrl("/apps/".concat(n.appId,"/cancel")),type:"POST",data:{shareId:$(e.target).closest(".item").attr("share-id")},beforeSend:function(){OC.msg.startAction(r,t(n.appId,"Setting..."))}}).done((function(e){n._rerenderItemData(e)})).fail((function(e){s.data.message=t(n.appId,"Failed"),void 0!==e.responseJSON.message&&(s.data.message+=": ",s.data.message+=e.responseJSON.message)})).always((function(){OC.msg.finishedAction(r,s),i.removeAttr("disabled")}))}else i.removeAttr("disabled")}))},_onLogDownloadEvent:function(e){var i=$(".item[share-id]").find("button, input, textarea");i.attr("disabled","disabled");var n=$(e.target).closest("li").find(".msg"),a={status:"",data:{message:""}},r=$(e.target).closest(".item").attr("share-id");$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/log/").concat(r)),type:"GET",beforeSend:function(){OC.msg.startAction(n,t(this.appId,"Loading..."))}}).done((function(e){void 0!==e.data.path&&(window.location.href=e.data.path),a.status="success",a.data.message="OK"})).fail((function(e){a.data.message=t(this.appId,"Unable to load"),void 0!==e.responseJSON.message&&(a.data.message=e.responseJSON.message)})).always((function(e){OC.msg.finishedAction(n,a),i.removeAttr("disabled")}))},_onLogDeletelEvent:function(e){var i=$(".item[share-id]").find("button, input, textarea");i.attr("disabled","disabled");var n=this;OC.dialogs.confirm(t(this.appId,"The subscription to the shared link will be deleted."),t(this.appId,"Please confirm the removal"),(function(t){if(t){var a=$(e.target).closest(".item").attr("share-id");$.ajax({context:n,url:OC.generateUrl("/apps/".concat(n.appId,"/log/").concat(a)),type:"DELETE"}).done((function(e){$(".item[share-id = ".concat(a,"]")).remove()})).always((function(e){i.removeAttr("disabled"),n.render()}))}else i.removeAttr("disabled")}))}}),OCA.FileSubscription.TabView=a}]);